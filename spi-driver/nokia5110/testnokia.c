#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include "testnokia5110.h"

uint8_t writebuf[64];
struct position coordinate;

uint8_t image_buffer[504] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xc0, 0xc0, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0xe0, 0xf0, 0xe0, 0xf0, 0xf0, 0xe0, 0xf0, 0xf0, 0xe0, 0xe0, 0xe0, 0xc0, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xfc, 0xfc, 0xfe, 0xff, 0xdf, 0xff, 0xff, 0xdf, 0xdf, 0xef, 0xff, 0x7f, 0x3f, 0xff, 0x9f, 0x07, 0x1e, 0xfb, 0xe4, 0xe9, 0xd3, 0xa7, 0xa7, 0xcf, 0xdf, 0xff, 0xff, 0x9f, 0x1f, 0x3f, 0x7f, 0xff, 0xfc, 0xfc, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x30, 0x58, 0xdc, 0x7c, 0xde, 0xfe, 0xff, 0xfd, 0xbe, 0xbf, 0xbf, 0xdf, 0xdf, 0xcf, 0x9d, 0xdf, 0xbe, 0x3e, 0xbd, 0xbf, 0x1f, 0x9f, 0xce, 0xef, 0xcf, 0xc7, 0xe7, 0xfb, 0xf3, 0xe3, 0xe3, 0xe3, 0xff, 0xf7, 0xe7, 0xef, 0xce, 0x5f, 0xde, 0x9e, 0x7d, 0x7f, 0x7e, 0x7c, 0x5c, 0x1c, 0x18, 0x30, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x03, 0x01, 0x01, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x0f, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x03, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

int main()
{
    int fd, i;
    char option;
    fd = open("/dev/nokia5110", O_RDWR);
    if (fd < 0)
    {
        printf("Cannot open device file...\n");
        return 0;
    }
    printf("Create a fake image\n");
    /*
      fd1 = open("image.txt", O_RDWR);
      if (fd1 < 0)
      {
          printf("Cannot open image file...\n");
          return 0;
      }
      uint8_t data;
      while ((data = getc(fd1)) != EOF)
      {
          strcat(image_buffer, &data);
      }
      close(fd1); */

    /*
    for(i = 0; i < 3200; ++i){
        image_buffer[i] = 0xAE;
    };
    */
    while (1)
    {
        printf("Please enter the option\n");
        printf("1. Write\n");
        // printf("2. Read\n");
        printf("2. Go to next line\n");
        printf("3. Go to custom location\n");
        printf("4. Clear screen\n");
        printf("5. Print image\n");
        printf("6.Exit\n");
        scanf("%c", &option);
        printf("Your option = %c\n", option);

        switch (option)
        {
        case '1':
            printf("Enter the string to write into the driver: ");
            scanf(" %[^\t\n]s", writebuf);
            printf("Data Wrtiting ...");
            write(fd, writebuf, strlen(writebuf) + 1);
            printf("Done!\n");
            break;
        /*case '2':
            printf("Data Reading ...");
            read(fd, readbuf, 64);
            printf("Done!\n\n");
            printf("%s\n", readbuf);
            break; */
        case '2':
            if (ioctl(fd, NEXT_LINE) < 0)
                return -1;
            break;
        case '3':
            printf("Enter the location you want to set the cursor at: \n");
            printf("X = ");
            scanf("%d", &coordinate.x);
            printf("Y = ");
            scanf("%d", &coordinate.y);
            if (ioctl(fd, GOTO_XY, &coordinate) < 0)
                return -1;
            break;
        case '4':
            if (ioctl(fd, CLEAR) < 0)
                return -1;
            break;
        case '5':
            if (ioctl(fd, PRINT_IMAGE, image_buffer) < 0)
                return -1;
            break;
        case '6':
            close(fd);
            exit(1);
            break;
        default:
            printf("Enter valid option = %c\n", option);
            break;
        }
    }
    close(fd);
}
